include(admCheckVapourSynth)
include(dm_plugin)
checkVapourSynth()

IF(USE_VAPOURSYNTH)
        ADD_DEFINITIONS("-std=c++11")
        ADD_DEFINITIONS(${VAPOURSYNTHSCRIPT_CFLAGS})
        SET(SRCS ADM_vsProxy.cpp)
        ADD_EXECUTABLE(vsProxy ${SRCS})
        GET_TARGET_PROPERTY(OLD PROPERTIES LINK_FLAGS)
        IF("${OLD}" MATCHES ".*NOT.*FOUND")
                SET(OLD "")
        ENDIF("${OLD}" MATCHES ".*NOT.*FOUND")
# Keep -L, discard everything else
        FOREACH(i ${VAPOURSYNTHSCRIPT_LDFLAGS})
           IF(${i} MATCHES "^-l")
                MESSAGE(STATUS "Updating linker libs  => ${i}")
                LIST(APPEND LIBS_TO_LINK  ${i})
           ENDIF(${i} MATCHES "^-l")
           IF(${i} MATCHES "^-L")
                MESSAGE(STATUS "Updating linker flags  => ${i}")
                SET(OLD "${i} ${OLD} ") 
           ENDIF(${i} MATCHES "^-L")
        ENDFOREACH(i ${VAPOURSYNTHSCRIPT_LDFLAGS})
        SET_TARGET_PROPERTIES(vsProxy PROPERTIES LINK_FLAGS "${OLD}")
        TARGET_LINK_LIBRARIES(vsProxy ADM_coreSocket6 ADM_core6 ${LIBS_TO_LINK})

        ADM_INSTALL_BIN(vsProxy)
ENDIF(USE_VAPOURSYNTH)
